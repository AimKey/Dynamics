
@using Dynamics.Utility
@using Newtonsoft.Json
@inject IHttpContextAccessor Accessor
@model Dynamics.Models.Models.ViewModel.OrganizationVM


@{
    ViewData["Title"] = "ManageOrganizationMember";
    Layout = "_LayoutOrganization";
}

@{
    //current usser
    var userString = Accessor.HttpContext.Session.GetString("user");
    User currentUser = null;
    if (userString != null)
    {
        currentUser = JsonConvert.DeserializeObject<User>(userString);
    }
}

<div class="py-5 pt-12 px-5 flex justify-center">
    <div class="border border-solid border-gray-500 rounded-box px-5 py-5 w-auto">
        <h1 class="text-3xl font-semibold mb-4 text-center ">
            <span class="border-b-2 border-gray-500 border-solid py-2">Organization members</span>
        </h1>

        @if (@currentUser.UserID.Equals(@Model.CEO.UserID))
        {
            <div class="flex justify-center space-x-4 my-5 py-5">
                <button class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                Invite members
            </button>

            <a asp-action="ManageRequestJoinOrganization" asp-controller="Organization" asp-route-organizationId="@Model.OrganizationID">
                <button class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                    Review join request
                </button>
            </a>
            
            </div>
        }
        

        <div class="flex justify-center ">
            <ul class="space-y-2">

                <li class="flex items-center justify-between bg-white shadow-xl px-5 py-1 rounded-box ">
                    <div class="flex items-center gap-2">
                        <span class="text-gray-500 text-sm font-semibold">1.</span>
                        <a asp-action="Details" asp-controller="EditUser" asp-route-id="@Model.CEO.UserID">
                            <img src="@(Model.CEO.UserAvatar ?? "https://via.placeholder.com/32") " alt="@Model.CEO.UserFullName" class=" w-16 h-16 mr-5 rounded-full">
                        </a>
                        <a asp-action="Details" asp-controller="EditUser" asp-route-id="@Model.CEO.UserID">
                            <span class="text-sm mx-5 font-semibold">@Model.CEO.UserFullName </span>
                        </a>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="text-sm mx-5 font-semibold ">Leader</span>
                    </div>
                    @if (@currentUser.UserID.Equals(@Model.CEO.UserID))
                    {

                        <div class="flex items-center gap-2 ">
                            <a asp-action="TransferCeoOrganization" asp-controller="Organization">
                                <span class="bg-blue-500 text-white font-bold px-3 py-3 ml-5 rounded text-xs">Transfer</span>
                            </a>
                        </div>
                    }

                </li>

                @{
                    int index = 1;
                    bool member = false;

                    foreach(var item in Model.OrganizationMember)
                    {
                        
                    }
                }
                @foreach (var item in @Model.OrganizationMember)
                {

                    index++;
                    if (item.UserID.Equals(Model.CEO.UserID) || item.Status == 0)
                    {
                        index--;
                        continue;
                    }
                    <li class="flex items-center justify-between bg-white shadow-xl px-5 py-1 my-5 rounded-box ">
                        <div class="flex items-center gap-2">
                            <span class="text-gray-500 text-sm font-semibold">@index.</span>
                            <a asp-action="Details" asp-controller="EditUser" asp-route-id="@item.UserID">
                                <img src="@(item.User.UserAvatar ?? "https://via.placeholder.com/32")" alt="@item.User.UserFullName" class="w-16 h-16 mr-5 rounded-full">
                            </a>

                            <a asp-action="Details" asp-controller="EditUser" asp-route-id="@item.UserID">
                                <span class="text-sm mx-5 font-semibold">@item.User.UserFullName</span>
                            </a>

                        </div>
                        <div class="flex items-center gap-2">
                            <span class="text-sm mx-5 font-semibold">Member</span>
                        </div>

                        @*ban member*@
                        @if (currentUser.UserID.Equals(@Model.CEO.UserID))
                        {
                            <form asp-action="OutOrganization" asp-controller="Organization" asp-route-organizationId="@Model.OrganizationID">
                                <input value="@item.UserID" name="userId" type="hidden">
                                <button class="bg-red-500 hover:bg-red-600 font-bold text-white ml-5 px-3 py-3 rounded text-xs" type="submit">Remove</button>
                            </form>
                        }

                    </li>
                }

                <!-- Repeat the above <li> element 7 more times for the remaining members, removing the Leader span -->
            </ul>
        </div>
    </div>


</div>
