@using Dynamics.Utility
@using Newtonsoft.Json
@inject IHttpContextAccessor Accessor
@model IEnumerable<Dynamics.Models.Models.OrganizationResource>


@{
    ViewData["Title"] = "ManageOrganizationResource";
    Layout = "_LayoutOrganization";
}

@{
    //current usser
    var userString = Accessor.HttpContext.Session.GetString("user");
    User currentUser = null;
    if (userString != null)
    {
        currentUser = JsonConvert.DeserializeObject<User>(userString);
    }

    //current Organization
    var organizationString = Accessor.HttpContext.Session.GetString("organization");
    Organization currentOrganization = null;
    if (organizationString != null)
    {
        currentOrganization = JsonConvert.DeserializeObject<Organization>(organizationString);
    }

    //Members in a organization with orrganizationId
    var userMembersInOrganization = Accessor.HttpContext.Session.Get<List<User>>(MySettingSession.SESSION_User_In_A_OrganizationID_KEY);

    //find Ceo Oragnization
    User userCeoOrganization = new User();
    foreach (var item in userMembersInOrganization)
    {
        if (item.UserID.Equals(currentOrganization.CEOID))
        {
            userCeoOrganization = item;
            break;
        }
    }
}

<div class="py-5 pt-12 px-5 flex justify-center">
    <div class="border border-solid border-gray-500 rounded-box px-5 py-5 w-auto">

        <h1 class="text-3xl font-semibold mb-10 text-center ">
            @if (currentUser.UserID.Equals(currentOrganization.CEOID))
            {
                <span class="border-b-2 border-gray-500 border-solid py-2">Manage and allocate resources for your projects</span>
            }
            else
            {

                <span class="border-b-2 border-gray-500 border-solid py-2">Organization Resources</span>
            }
            
        </h1>

        <div class=" flex justify-center mt-10 mb-10">

            @if (currentUser.UserID.Equals(currentOrganization.CEOID))
            {
                <div class="max-w-3xl border border-solid border-gray-500 rounded-box px-5 py-5 w-auto">

                    @if (currentUser.UserID.Equals(currentOrganization.CEOID))
                    {
                        <h1 class="text-2xl mb-4 font-bold text-center">Current organization resources</h1>
                        <div class="flex justify-center mt-10">
                            <a asp-action="AddNewOrganizationResource" asp-controller="Organization">
                                <button class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition">
                                    Add new Resource
                                </button>
                            </a>
                        </div>

                    }
                    <div class=" px-5 py-3 w-auto">
                        <ul class="space-y-2">

                        @foreach (var item in Model)
                        {
                            <li class="flex items-center justify-between bg-white shadow-xl px-5 py-4 rounded-box ">
                                <div class="flex items-center gap-2">
                                    <span class="text-gray-500 text-sm font-semibold">1.</span>
                                    <span class="text-sm mx-5 font-semibold">@item.ResourceName</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-sm mx-5 font-semibold">@item.Quantity</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-sm mx-5 font-semibold ">@item.Unit</span>
                                </div>
                                @* 
                                <div class="flex items-center gap-2 ">
                                    <span class="bg-green-500 text-white font-bold px-3 py-2 ml-5 rounded text-xs">Update</span>
                                </div>
 *@
                                @if (currentUser.UserID.Equals(currentOrganization.CEOID))
                                {
                                        @if(item.Quantity == 0)
                                        {
                                            <div class="flex items-center gap-2 ">
                                                <span class="bg-red-500 text-white font-bold px-3 py-2 ml-5 rounded text-xs">Remove</span>
                                            </div>
                                        }
                                        else
                                        {
                                            <div class="flex items-center gap-2 ">
                                                <span class="bg-gray-600 text-white font-bold px-3 py-2 ml-5 rounded text-xs">Remove</span>
                                            </div>
                                        }

                                    <a asp-action="SendResoueceOrganizationToProject" asp-controller="Organization">
                                            <div class="flex items-center gap-2 ">
                                                <span class="bg-blue-600 text-white font-bold px-3 py-2 ml-5 rounded text-xs">Send</span>
                                            </div>
                                    </a>
                                    
                                }

                            </li>
                        }


                    </ul>
                    </div>
                </div>
            }
            else
            {
                <div>

                    <div class=" px-5 py-3 w-auto">
                        <ul class="space-y-2">

                            @foreach (var item in Model)
                            {
                                <li class="flex items-center justify-between bg-base-100 shadow-xl px-5 py-4 rounded-box ">
                                    <div class="flex items-center gap-2">
                                        <span class="text-gray-500 text-sm font-semibold">1.</span>
                                        <span class="text-sm mx-5 font-semibold">@item.ResourceName</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span class="text-sm mx-5 font-semibold">@item.Quantity</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span class="text-sm mx-5 font-semibold ">@item.Unit</span>
                                    </div>

                                    @if (item.ResourceName.ToUpper().Contains("Money".ToUpper()))
                                    {
                                        <a asp-action="DonateByMoney" asp-controller="Organization">
                                            <div class="flex items-center gap-2 ">
                                                <span class="bg-green-500 text-white font-bold px-3 py-2 ml-5 rounded text-xs">Donate Here</span>
                                            </div>
                                        </a>
                                        
                                    }
                                    else
                                    {
                                        <a asp-action="DonateByResource" asp-controller="Organization">
                                            <div class="flex items-center gap-2 ">
                                                <span class="bg-green-500 text-white font-bold px-3 py-2 ml-5 rounded text-xs">Donate Here</span>
                                            </div>
                                        </a>
                                        
                                    }


                                </li>
                            }

                            

                        </ul>
                    </div>
                </div>
            }

           
        </div>

        @if (currentUser.UserID.Equals(currentOrganization.CEOID))
        {
            <div class=" flex justify-center mt-10 mb-10">
                <div class="max-w-3xl border border-solid border-gray-500 rounded-box px-5 py-5 w-auto">

                    <h1 class="text-2xl font-bold mb-2 text-center">Project resource allocations</h1>
                    <p class="text-gray-600 mb-4 text-center">Send your organization resources to your projects</p>
                    @*
                <div class="flex justify-center">
                <button class="bg-blue-600 text-white px-4 py-2 rounded-md mb-2 hover:bg-blue-700 transition">
                Allocate new resource
                </button>
                </div>
                *@

                    <div class=" px-5 py-3 w-auto">
                        <ul class="space-y-4">
                            @for (int i = 0; i < 4; i++)
                            {
                                <div class="w-full border rounded-lg  p-4 bg-white shadow-xl rounded-box ">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="flex items-center space-x-3 mr-5">
                                            <span class="font-semibold">1.</span>
                                            <div class="mx-5">
                                                <h2 class="font-semibold">Bento</h2>
                                                <p class="text-sm text-gray-500">29/07/2024</p>
                                            </div>
                                        </div>
                                        <div class="space-x-3 mx-5">
                                            <button class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 transition">
                                                Not accepted
                                            </button>
                                            <button class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 transition">
                                                Accepted
                                            </button>
                                            <button class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 transition">
                                                Cancel
                                            </button>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-4 gap-6">
                                        <span class="font-semibold">Bento</span>
                                        <span>Box</span>
                                        <span>100</span>
                                        <span class="text-gray-600">To: Project abcxyz ákldíjsdj</span>
                                    </div>
                                </div>
                            }
                        </ul>
                    </div>
                </div>


            </div>
        }

        
    </div>
</div>