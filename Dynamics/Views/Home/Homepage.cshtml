@using Dynamics.Utility
@using Microsoft.AspNetCore.Mvc.TagHelpers
@using Microsoft.IdentityModel.Tokens
@using Newtonsoft.Json
@model Dynamics.Models.Models.ViewModel.HomepageViewModel

@{
    ViewData["Title"] = "HomePage";
    var isAuthenticated = User.Identity.IsAuthenticated;
    if (!isAuthenticated)
    {
        Layout = "CustomLayout/_LayoutForGuest";
    }
    else
    {
        Layout = "CustomLayout/_LayoutWithNavbarAndImage";
    }

    var userString = Accessor.HttpContext.Session.GetString("user");
    User currentUser = null;
    if (userString != null)
    {
        currentUser = JsonConvert.DeserializeObject<User>(userString);
    }
    else
    {
        currentUser = new User
        {
            UserFullName = "Guest",
            UserRole = RoleConstants.Guest,
        };
    }
}

<!-- The body of the home page -->
<div class="-mt-12 z-10 relative bg-white rounded-3xl px-8 py-16 flex flex-col gap-20">
<h1 class="text-center text-3xl text-primary font-bold align-with-navbar-center">
    Help requests
</h1>
<!-- Help request section -->
@if (Model.Requests.IsNullOrEmpty())
{
    <h3 class="text-center text-neutral italic text-2xl">Nobody is here to help.</h3>
}
<section class="flex flex-col justify-center items-center splide"
         aria-labelledby="carousel-heading">
    @if (!Model.Requests.IsNullOrEmpty())
    {
        <!-- TODO: Replace this with link to view requests -->
        <a href="#" class="w-full text-end text underline text-blue-700 font-bold">
            View more request &rarr;
        </a>
        <div class="splide__track flex w-10/12 py-8 px-8">
            <!-- List of request cards -->
            <ul class="splide__list w-full">
                <!-- Card -->
                @{
                    if (!Model.Requests.IsNullOrEmpty())
                    {
                        foreach (var request in Model.Requests)
                        {
                            <li class="card w-full max-w-64 min-h-[432px] shadow-xl mr-4 relative splide__slide elevate rounded-md">
                                <a asp-action="Index" asp-controller="Request" asp-route-id="@request.RequestID">
                                    <img class="w-full object-cover h-48 rounded-md"
                                         src="@request.FirstImageAttachment"
                                         alt="Shoes"/>
                                </a>
                                <div class="card-body p-2 gap-2 w-full">
                                    <!-- Badge left -->
                                    <div
                                        class="badge badge-secondary outline-none border-none absolute top-2 left-2 bg-error font-bold text-white px-4 py-3">
                                        Request
                                    </div>
                                    <div class="flex flex-col">
                                        <a class="card-title text-primary font-bold mb-2 line-clamp-2" asp-action="Index"
                                           asp-controller="Request" asp-route-id="@request.RequestID">
                                                @request.RequestTitle
                                        </a>
                                        <div class="flex justify-between items-start gap-4">
                                            <a class="text-neutral hover:text-primary flex-1 line-clamp-2" asp-action="Index"
                                               asp-controller="User" asp-route-username="@request.Username">
                                                @request.Username
                                            </a>
                                            <span class="flex-1 text-end line-clamp-2">@request.Location</span>
                                        </div>
                                    </div>
                                    <p class="text-base line-clamp-3 mb-4">
                                        @request.Content
                                    </p>
                                    <div class="card-actions justify-center flex-col items-center">
                                        <a asp-action="Index" asp-controller="Request" asp-route-id="@request.RequestID"
                                           class="btn btn-neutral h-8 min-h-0 outline-none border-none ">
                                            Accept
                                        </a>
                                    </div>
                                </div>
                            </li>
                            <!-- End card -->
                        }
                    }
                }
            </ul>
            <!-- End cards -->
        </div>
    }

</section>
<!-- End help request section -->
<div class="divider"></div>
<h1 class="text-center text-3xl text-primary font-bold carousel-heading align-with-navbar-center">
    Ongoing charity projects
</h1>
<!-- View charity projects section -->
@if (Model.OnGoingProjects.IsNullOrEmpty())
{
    <h3 class="text-center text-neutral italic text-2xl">
        No projects available, maybe the world is already a better
        place ?
    </h3>
}
<section class="flex flex-col justify-center items-center splide section"
         aria-labelledby="carousel-heading">
    @if (!Model.OnGoingProjects.IsNullOrEmpty())
    {
        <a href="#" class="w-full text-end text underline text-blue-700 font-bold">
            View more projects &rarr;
        </a>
        <div class="splide__track flex w-10/12 py-8 px-8">
            <!-- List of cards -->
            <ul class="splide__list w-full">
                <!-- Card -->
                @{
                    @if (!Model.OnGoingProjects.IsNullOrEmpty())
                    {
                        foreach (var projectOverviewDto in Model.OnGoingProjects)
                        {
                            <li class="card w-full max-w-64 min-h-[432px] shadow-xl mr-4 relative splide__slide elevate rounded-md">
                                <a asp-action="ManageProject" asp-route-id="@projectOverviewDto.ProjectID" asp-controller="Project">
                                    <img class="w-full object-cover h-48 rounded-md"
                                         src="@projectOverviewDto.Attachment"
                                         alt="Shoes"/>
                                </a>
                                <div class="card-body p-2 gap-2 w-full">
                                    <!-- badge left -->
                                    <div
                                        class="badge badge-success absolute top-2 left-2 bg-success font-bold px-4 py-3 outline-none border-none">
                                        Project
                                    </div>
                                    <!-- badge right -->
                                    <div
                                        class="badge badge-secondary absolute top-2 right-2 bg-success font-bold px-4 py-3 outline-none border-none">
                                        Project
                                    </div>
                                    @if (projectOverviewDto.ProjectStatus == 1)
                                    {
                                        <div
                                            class="badge badge-error absolute top-2 right-2 bg-error font-bold text-white px-4 py-3 outline-none border-none">
                                            On-going
                                        </div>
                                    }
                                    else
                                    {
                                        <div
                                            class="badge badge-accent absolute top-2 right-2 font-bold px-4 py-3 outline-none border-none">
                                            Preparing
                                        </div>
                                    }

                                    <div class="flex flex-col">
                                        <a class="card-title text-primary font-bold mb-2 line-clamp-2"
                                           asp-action="ManageProject" asp-route-id="@projectOverviewDto.ProjectID"
                                           asp-controller="Project">
                                            @projectOverviewDto.ProjectName
                                        </a>
                                        <div class="flex justify-between gap-4">
                                            <a class="text-neutral hover:text-primary flex-1 line-clamp-2 text-start" asp-action="Index"
                                               asp-controller="User"
                                               asp-route-username="@projectOverviewDto.ProjectLeader.UserFullName">
                                                @projectOverviewDto.ProjectLeader.UserFullName
                                            </a>
                                            <span class="flex-1 text-end line-clamp-2">
                                                @projectOverviewDto.ProjectAddress
                                            </span>
                                        </div>
                                    </div>
                                    <p class="line-clamp-3 mb-4">
                                        @projectOverviewDto.ProjectDescription
                                    </p>
                                    <div class="card-actions justify-center flex-col items-center">
                                        <div class="flex w-full flex-start items-center gap-2 text-base">
                                            <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"></path>
                                            </svg>
                                            <span>@projectOverviewDto.ProjectMembers volunteers</span>
                                        </div>
                                        <progress class="progress progress-success w-full"
                                                  value="@projectOverviewDto.ProjectProgress"
                                                  max="100">
                                        </progress>
                                        <p class="w-full text-success">Raised @projectOverviewDto.ProjectRaisedMoney VND</p>
                                        <a class="btn btn-neutral h-8 min-h-0 outline-none border-none"
                                           asp-action="ManageProject" asp-route-id="@projectOverviewDto.ProjectID"
                                           asp-controller="Project">
                                            View project
                                        </a>
                                    </div>
                                </div>
                            </li>
                            <!-- End card -->
                        }
                    }
                }
            </ul>
            <!-- End cards -->
        </div>
    }

</section>
<!-- End view charity projects section -->
<div class="divider"></div>
<h1 class="text-center text-3xl text-primary font-bold carousel-heading align-with-navbar-center">
    Active organizations
</h1>
<!-- View ORGANIZATION section -->
@if (Model.Organizations.IsNullOrEmpty())
{
    <h3 class="text-center text-neutral italic text-2xl">No organizations present. Lonely isn't it</h3>
}
<section class="flex flex-col justify-center items-center splide section"
         aria-labelledby="carousel-heading">
    @if (!Model.Organizations.IsNullOrEmpty())
    {
        <!-- TODO: Replace this with link to view org -->
        <a href="#" class="w-full text-end text underline text-blue-700 font-bold">
            View more organization &rarr;
        </a>
        <div class="splide__track flex w-10/12 py-8 px-8">
            <!-- List of cards -->
            <ul class="splide__list w-full">
                <!-- Card -->
                @{
                    if (!Model.Organizations.IsNullOrEmpty())
                    {
                        foreach (var modelOrganization in Model.Organizations)
                        {
                            <li class="card w-full max-w-64 min-h-[432px] shadow-xl mr-4 relative splide__slide elevate rounded-md">
                                <a asp-action="Detail" asp-controller="Organization"
                                   asp-route-organizationId="@modelOrganization.OrganizationID">
                                    <img class="w-full object-cover h-48 rounded-md"
                                         src="@modelOrganization.OrganizationPictures"
                                         alt="@modelOrganization.OrganizationName"/>
                                </a>
                                <div class="card-body p-2 gap-2 w-full">
                                    <!-- badge left -->
                                    <div
                                        class="badge badge-secondary absolute top-2 left-2 bg-primary font-bold text-white px-4 py-3 outline-none border-none">
                                        Organization
                                    </div>
                                    <div class="flex flex-col">
                                        <a class="card-title text-primary font-bold mb-2 line-clamp-2"
                                           asp-action="Detail" asp-controller="Organization"
                                           asp-route-organizationId="@modelOrganization.OrganizationID">
                                            @modelOrganization.OrganizationName
                                        </a>
                                        <div class="flex justify-between">
                                            <a class="text-neutral hover:text-primary flex-1 line-clamp-2 text-start" asp-action="Index"
                                               asp-controller="User"
                                               asp-route-username="@modelOrganization.OrganizationLeader.UserFullName">
                                                @modelOrganization.OrganizationLeader.UserFullName
                                            </a>
                                            <span class="flex-1 text-end line-clamp-2">@modelOrganization.OrganizationAddress</span>
                                        </div>
                                    </div>
                                    <p class="line-clamp-3 mb-4">
                                        @modelOrganization.OrganizationDescription
                                    </p>
                                    <div class="card-actions justify-center flex-col items-center">
                                        <div class="flex w-full flex-start items-center gap-2 text-base-content">
                                            <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"></path>
                                            </svg>
                                            <span>@modelOrganization.OrganizationMemberCount members</span>
                                        </div>
                                        @* TODO: Add redirect to join button *@
                                        <a class="btn btn-neutral h-8 min-h-0 outline-none border-none">
                                            Request to join
                                        </a>
                                    </div>
                                </div>
                            </li>
                            <!-- End card -->
                        }
                    }
                }
            </ul>
            <!-- End cards -->
        </div>
    }

</section>
<!-- End view charity projects section -->
<div class="divider"></div>


<!-- View SUCCESSES CHARITY section -->
<h1 class="text-center text-3xl text-primary font-bold carousel-heading align-with-navbar-center">
    Succeed charities
</h1>
@if (Model.SuccessfulProjects.IsNullOrEmpty())
{
    <h3 class="text-center text-neutral italic text-2xl">
        No successful projects presents, one day your project could
        be here.
    </h3>
}
<section class="flex flex-col justify-center items-center splide section"
         aria-labelledby="carousel-heading">
    @if (!Model.SuccessfulProjects.IsNullOrEmpty())
    {
        <!-- TODO: Replace this with link to view requests -->
        <a href="#" class="w-full text-end text underline text-blue-700 font-bold">
            View succeed charities &rarr;
        </a>
        <div class="splide__track flex w-10/12 py-8 px-8">
            <!-- List of cards -->
            <ul class="splide__list w-full">
                <!-- Card -->
                @{
                    foreach (var projectOverviewDto in Model.SuccessfulProjects)
                    {
                        <li href="#"
                            class="card w-full max-w-64 min-h-[432px] shadow-xl mr-4 relative splide__slide elevate rounded-md">
                            <figure>
                                @* This might has many attachment, write code to get the first one *@
                                <img class="w-full object-cover h-48 rounded-md"
                                     src="@projectOverviewDto.Attachment"
                                     alt="Shoes"/>
                            </figure>
                            <div class="card-body p-2 gap-2 w-full">
                                <!-- badge left -->
                                <div
                                    class="badge badge-success absolute top-2 left-2 bg-success font-bold px-4 py-3 outline-none border-none">
                                    Project
                                </div>
                                @* No badge bc already finished *@
                                <div class="flex flex-col">
                                    <h2 class="card-title text-primary font-bold mb-2 line-clamp-2">
                                        @projectOverviewDto.ProjectName
                                    </h2>
                                    <div class="flex justify-between gap-12">
                                        <a class="text-neutral hover:text-primary flex-1 line-clamp-2 text-start" asp-action="Index"
                                           asp-controller="User"
                                           asp-route-username="@projectOverviewDto.ProjectLeader.UserFullName">
                                            @projectOverviewDto.ProjectLeader.UserFullName
                                        </a>
                                        <span class="flex-1 text-end line-clamp-2">
                                            @projectOverviewDto.ProjectAddress
                                        </span>
                                    </div>
                                </div>
                                <p class="line-clamp-3 mb-4">
                                    @projectOverviewDto.ProjectDescription
                                </p>
                                <div class="card-actions justify-center flex-col items-center">
                                    <div class="flex w-full flex-start items-center gap-2 text-base">
                                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"></path>
                                        </svg>
                                        <span>@projectOverviewDto.ProjectMembers volunteers</span>
                                    </div>
                                    <progress class="progress progress-success w-full"
                                              value="@projectOverviewDto.ProjectProgress"
                                              max="100">
                                    </progress>
                                    <p class="w-full text-success">Raised @projectOverviewDto.ProjectRaisedMoney VND</p>
                                    <a class="btn btn-neutral h-8 min-h-0 outline-none border-none" asp-action="ManageProject" asp-route-id="@projectOverviewDto.ProjectID"
                                       asp-controller="Project">
                                        View project
                                    </a>
                                </div>
                            </div>
                        </li>
                        <!-- End card -->
                    }
                }
            </ul>
            <!-- End cards -->
        </div>
    }


</section>
<!-- End view charity projects section -->
</div>
<!-- End body -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
<partial name="_ValidationScriptsPartial"/>
<script src="https://cdn.jsdelivr.net/npm/@@splidejs/splide@4.1.4/dist/js/splide.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        Splide.defaults = {
            // perPage: 3,
            rewind: true,
            // type: "loop",
            perMove: 1,
            padding: "2rem",
            fixedWidth: "24rem",
            gap: "2rem",
            breakpoints: {
                900: {
                    fixedWidth: "250px",
                },
            }
        };
        var elms = document.getElementsByClassName("splide");
        for (var i = 0; i < elms.length; i++) {
            new Splide(elms[i]).mount();
        }
    });
</script>